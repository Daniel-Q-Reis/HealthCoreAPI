[mypy]
# Essential plugins to avoid generics errors in Django/DRF
plugins = mypy_django_plugin.main, mypy_drf_plugin.main

# ============================================================
# Strict Mode Configuration
# Full strict mode - all production code must be typed
# ============================================================

# Strict mode flag
strict = true

# Require type annotations
disallow_untyped_defs = true
disallow_incomplete_defs = true
disallow_untyped_decorators = true

# Type checking
check_untyped_defs = true
no_implicit_optional = true
strict_optional = true

# Warnings
warn_return_any = true
warn_unused_ignores = true
warn_unused_configs = true
warn_redundant_casts = true

# Keep for third-party libs without type stubs
ignore_missing_imports = True

[mypy.plugins.django-stubs]
django_settings_module = src.healthcoreapi.settings.development

# ============================================================
# Third-party Library Exceptions
# ============================================================
[mypy-google.generativeai]
ignore_missing_imports = True
follow_imports = skip

[mypy-google.generativeai.*]
ignore_missing_imports = True
follow_imports = skip

# ============================================================
# Test Files Exception
#
# RATIONALE:
# Pytest fixtures use dynamic patterns (decorators, dependency injection,
# parametrization) that are inherently difficult to type statically.
# Test code is NOT production code and does not run in production.
# The cost of fully typing 200+ test functions outweighs the benefit.
#
# SCOPE:
# - All files in src/apps/*/tests/ directories
# - All files matching test_*.py pattern
# - src/conftest.py (pytest configuration)
#
# RELAXED SETTINGS:
# - disallow_untyped_defs = false (allow untyped test functions)
# - disallow_untyped_decorators = false (allow pytest decorators)
# - disallow_incomplete_defs = false (allow partial type hints)
# - check_untyped_defs = false (don't check untyped test code)
# - warn_return_any = false (allow Any returns in tests)
# - disallow_any_generics = false (allow untyped generics)
#
# IMPORTANT: This exception does NOT apply to production code.
# All src/apps/*/models.py, services.py, repositories.py, views.py,
# serializers.py, admin.py, permissions.py MUST remain fully typed.
# ============================================================

# Pytest configuration file
[mypy-src.conftest]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false
disallow_any_generics = false

# Test files in apps (tests.py pattern)
[mypy-src.apps.*.tests]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false
disallow_any_generics = false

# Test files in test directories (test_*.py pattern)
[mypy-src.apps.*.tests.*]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false
disallow_any_generics = false

# Core app test files
[mypy-src.apps.core.tests.*]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false
disallow_any_generics = false

# ============================================================
# Protobuf Generated Files Exception
#
# RATIONALE:
# Protobuf files are auto-generated by protoc and cannot be manually edited.
# They contain type stubs that may not conform to strict mypy rules.
# These files have 'DO NOT EDIT' warnings in their headers.
#
# SCOPE:
# - All *_pb2.py files (protobuf message implementations)
# - All *_pb2.pyi files (protobuf type stubs)
# - All *_pb2_grpc.py files (gRPC service stubs)
# ============================================================

[mypy-src.apps.core.grpc_proto.audit_pb2]
ignore_errors = True

[mypy-src.apps.core.grpc_proto.audit_pb2_grpc]
ignore_errors = True

# ============================================================
# Test Scripts Exception
#
# RATIONALE:
# Scripts in scripts/ are for manual testing and debugging.
# They are not production code and don't run in production.
# ============================================================

[mypy-scripts.test_grpc]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false

[mypy-scripts.test_kafka_integration]
disallow_untyped_defs = false
disallow_untyped_decorators = false
disallow_incomplete_defs = false
check_untyped_defs = false
warn_return_any = false
